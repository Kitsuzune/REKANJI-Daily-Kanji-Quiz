<div class="max-w-4xl mx-auto px-4">
  <!-- Header -->
  <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl p-6 mb-8">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-2xl md:text-3xl font-bold">
          <%= @exam_attempt.level %> Exam - <%= @exam_attempt.exam_mode.capitalize %>
        </h1>
        <p class="opacity-90">
          Question <%= @current_question_index %> of <%= @total_questions %>
        </p>
      </div>
      
      <!-- Timer -->
      <div class="text-right">
        <div class="text-lg font-semibold" id="timer">
          <%= @time_remaining %>:00
        </div>
        <div class="text-sm opacity-90">Time Remaining</div>
      </div>
    </div>
    
    <!-- Progress Bar -->
    <div class="mt-4">
      <div class="flex justify-between items-center mb-2">
        <span class="text-white font-medium">Progress</span>
        <span class="text-white"><%= @current_question_index %>/<%= @total_questions %></span>
      </div>
      <div class="w-full bg-white bg-opacity-20 rounded-full h-2">
        <div class="bg-white h-2 rounded-full transition-all duration-300" 
             style="width: <%= @total_questions && @total_questions > 0 ? (@current_question_index.to_f / @total_questions * 100).round(2) : 0 %>%"></div>
      </div>
    </div>
  </div>

  <!-- Question Card -->
  <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
    <div class="text-center mb-8">
      <!-- Question Display -->
      <% case @question[:type] %>
      <% when 'kanji_to_meaning' %>
        <div class="text-8xl font-bold text-gray-800 mb-6 kanji-character">
          <%= @question[:kanji].kanji %>
        </div>
        <h2 class="text-2xl text-gray-700 mb-4">What does this kanji mean?</h2>
        <% if @exam_attempt.exam_mode == 'casual' %>
          <p class="text-lg text-gray-500">Reading: <%= @question[:kanji].display_reading %></p>
        <% end %>
        
      <% when 'kanji_to_reading' %>
        <div class="text-8xl font-bold text-gray-800 mb-6 kanji-character">
          <%= @question[:kanji].kanji %>
        </div>
        <h2 class="text-2xl text-gray-700 mb-4">How do you read this kanji?</h2>
        <% if @exam_attempt.exam_mode == 'casual' %>
          <p class="text-lg text-gray-500">Meaning: <%= @question[:kanji].meaning_id %></p>
        <% end %>
        
      <% when 'meaning_to_kanji' %>
        <div class="text-4xl font-bold text-gray-800 mb-6">
          "<%= @question[:kanji].meaning_id %>"
        </div>
        <h2 class="text-2xl text-gray-700 mb-4">Which kanji has this meaning?</h2>
        <% if @exam_attempt.exam_mode == 'casual' %>
          <p class="text-lg text-gray-500">Reading: <%= @question[:kanji].display_reading %></p>
        <% end %>
        
      <% when 'reading_to_kanji' %>
        <div class="text-4xl font-bold text-gray-800 mb-6">
          "<%= @question[:correct_reading] %>"
        </div>
        <h2 class="text-2xl text-gray-700 mb-4">Which kanji is read this way?</h2>
        <% if @exam_attempt.exam_mode == 'casual' %>
          <p class="text-lg text-gray-500">Meaning: <%= @question[:kanji].meaning_id %></p>
        <% end %>
      <% end %>
    </div>

    <!-- Answer Options -->
    <%= form_with url: exam_answer_path(@exam_attempt), method: :post, local: true, class: "exam-form" do |form| %>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
        <% @question[:options].each_with_index do |option, index| %>
          <label class="exam-option cursor-pointer p-6 rounded-lg border-2 border-gray-200 hover:border-indigo-400 hover:bg-indigo-50 transition-all duration-200 transform hover:-translate-y-1 hover:shadow-md">
            <%= form.radio_button :answer, option, 
                class: "sr-only", 
                id: "option_#{index}",
                required: true %>
            <span class="block text-lg font-semibold text-center"><%= option %></span>
          </label>
        <% end %>
      </div>

      <!-- Navigation Buttons -->
      <div class="mt-8">
        <!-- Question Counter -->
        <div class="text-center mb-4">
          <p class="text-gray-600">Question <%= @current_question_index %> of <%= @total_questions %></p>
        </div>
        
        <!-- Button Container -->
        <div class="flex justify-center">
          <!-- Next/Finish Button -->
          <%= form.submit (@current_question_index == @total_questions ? "Finish Exam" : "Next Question"), 
              class: "px-8 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium text-lg" %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- Timer JavaScript -->
<script>
let timeRemaining = Math.floor(<%= @time_remaining * 60 %>); // Convert to seconds and round down

function updateTimer() {
  const minutes = Math.floor(timeRemaining / 60);
  const seconds = timeRemaining % 60;
  
  document.getElementById('timer').textContent = 
    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  
  if (timeRemaining <= 0) {
    // Time's up - submit form automatically
    document.querySelector('.exam-form').submit();
    return;
  }
  
  // Change color when time is running low
  if (timeRemaining <= 300) { // 5 minutes
    document.getElementById('timer').className = 'text-lg font-semibold text-red-400';
  } else if (timeRemaining <= 600) { // 10 minutes
    document.getElementById('timer').className = 'text-lg font-semibold text-yellow-400';
  }
  
  timeRemaining--;
}

// Update timer every second
setInterval(updateTimer, 1000);

// Radio button styling
document.querySelectorAll('.exam-option').forEach(option => {
  option.addEventListener('click', function() {
    // Remove selected class from all options
    document.querySelectorAll('.exam-option').forEach(opt => {
      opt.classList.remove('border-indigo-500', 'bg-indigo-100');
    });
    
    // Add selected class to clicked option
    this.classList.add('border-indigo-500', 'bg-indigo-100');
  });
});
</script>

<style>
.kanji-character {
  font-family: 'Noto Sans CJK JP', 'Hiragino Sans', 'Yu Gothic', sans-serif;
}

.exam-option input[type="radio"]:checked + span {
  color: #4f46e5;
  font-weight: bold;
}
</style>
